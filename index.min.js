/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=t.TagPicker||{},t.TagPicker.Sort=e())}(this,(function(){"use strict";var t,e,n,r=function(t){return"function"==typeof t},i=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||function(t,e){return t&&o(e)&&t instanceof e}(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},a=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return u(e)}))},u=function(t){return t.toUpperCase()},s=function(t){if(function(t){return Array.isArray(t)}(t))return t.map((function(e){return s(t)}));if(i(t)){for(var e in t)t[e]=s(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},c=function(t,e){return t.style[a(e)]=null,t},f=function(t,e,n){return t.style[a(e)]=s(n),t},l=(t=function(t){var e,n=t._mask,r=n.tags,i=n.text;e=i,r.append(e)},e=0,function(){var r=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){return t.apply(i,r)}),e)}),v=new WeakMap;function p(t){return v.get(t)}function d(t){var e=this._picker,n=e._active,r=e._mask,i=e._tags,o=e.state,a=r.input,u=o.n,s=t.from,f=t.item,l=t.to;n&&(a.contentEditable=!0,s&&c(s,"cursor"),l&&c(l,"cursor"),(f=i.get(f.title))&&function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}}((function(){return(t=f,e=u+"__tag--selected",t.classList.add(e),t).focus();var t,e}),0)())}function _(t){var e=this._picker;e._active&&l(e)}function g(t){var e,n=this._picker,r=n._active;n._tags;var i=n.self,o=n.state;o.n;var a=t.item;if(r){var u=this.toArray().slice(0,-1);i.value=u.join(o.join),n.fire("sort.tag",[e=a.title]).fire("change",[e]),n.value=n.value}}function m(t){var e=this._picker,n=e._active,r=e._mask.input,i=t.from,o=t.to;n&&(r.contentEditable=!1,i&&f(i,"cursor","move"),o&&f(o,"cursor","move"))}return{attach:function(){var t=this,e=t.constructor.prototype;!r(e.reverse)&&(e.reverse=function(){var t=this,e=p(t),n=t._active,r=t.self,i=t.state.join;if(!n)return t;var o=e.toArray(),a=o.pop();return o=o.reverse(),r.value=o.join(i),e.sort(o.concat(a),!0),t.fire("sort.tags",[o])}),!r(e.sort)&&(e.sort=function(t){var e=this,n=p(e),r=e._active,i=e.self,o=e.state.join;if(!r)return e;t=(t||function(t,e){return t.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}).bind(e);var a=n.toArray(),u=a.pop();return a=a.sort(t),i.value=a.join(o),n.sort(a.concat(u),!0),e.fire("sort.tags",[a])});var n,i,o=t._mask,a=t.state,u=o.tags,s=a.n,c=s+"__tag--",f=new Sortable(u,{animation:150,chosenClass:c+"select",dataIdAttr:"title",dragClass:c+"move",filter:"."+s+"__text",forceFallback:!0,ghostClass:c+"ghost",onEnd:d,onMove:_,onSort:g,onStart:m,selectedClass:c+"selected"});return f._picker=t,n=t,i=f,v.set(n,i),t},detach:function(){var t,e=p(this);t=this,v.delete(t),e&&e.destroy()},name:"TagPicker.Sort"}}));