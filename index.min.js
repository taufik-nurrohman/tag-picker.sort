/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):((t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=t.TagPicker||{},t.TagPicker.Sort=r())}(this,(function(){"use strict";var t=function(t){return"function"==typeof t},r=function(t,r){return void 0===r&&(r=!0),"object"==typeof t&&(!r||function(t,r){return t&&e(r)&&t instanceof r}(t,Object))},e=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},n=function(t){return t.replace(/[-_.](\w)/g,(function(t,r){return o(r)}))},o=function(t){return t.toUpperCase()},i=function(t){if(function(t){return Array.isArray(t)}(t))return t.map((function(r){return i(t)}));if(r(t)){for(var e in t)t[e]=i(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},a=window,u=function(t,r){return t.style[n(r)]=null,t},c=function(t,r,e){return t.style[n(r)]=i(e),t},s=new WeakMap;function f(t,r,e,n,o){var i=t._mask,u=t.state.n,c=i.tags,s=u+="__tag--";return new(t.constructor.$.Sortable||a.Sortable)(c,{animation:150,chosenClass:s+"select",dataIdAttr:"title",dragClass:s+"move",filter:"."+u+"__text",forceFallback:!0,ghostClass:s+"ghost",onEnd:r,onMove:e,onSort:n,onStart:o,selectedClass:s+"selected"})}function l(t){return s.get(t)}function v(t){var r=t.from,e=t.to;r&&u(r,"cursor"),e&&u(e,"cursor")}function d(){var t=this,r=l(t);r&&r.destroy(),(r=f(t,v,p,g,h))._picker=t,_(t,r)}function p(t){var r=this._picker,e=r._active,n=r._mask.text;if(e)return t.related!==n}function g(t){var r,e=this._picker,n=e._active,o=e._mask,i=e.self,a=e.state,c=o.tags,s=t.item;if(n){var f=this.toArray().slice(0,-1);i.value=f.join(a.join),e.fire("sort.tag",[r=s.title]).fire("change",[r]),e.value=e.value,u(c,"cursor")}}function h(t){var r=this._picker._active,e=t.from,n=t.to;r&&(e&&c(e,"cursor","move"),n&&c(n,"cursor","move"))}function _(t,r){return s.set(t,r)}return{attach:function(){var r=this,e=r.constructor,n=e.prototype;e.$=e.$||{},!t(n.reverse)&&(n.reverse=function(){var t=this,r=l(t),e=t._active,n=t.self,o=t.state.join;if(!e)return t;var i=r.toArray(),a=i.pop();return i=i.reverse(),n.value=i.join(o),r.sort(i.concat(a),!0),t.fire("sort.tags",[i])}),!t(n.sort)&&(n.sort=function(t){var r=this,e=l(r),n=r._active,o=r.self,i=r.state.join;if(!n)return r;t=(t||function(t,r){return t.localeCompare(r,void 0,{numeric:!0,sensitivity:"base"})}).bind(r);var a=e.toArray(),u=a.pop();return a=a.sort(t),o.value=a.join(i),e.sort(a.concat(u),!0),r.fire("sort.tags",[a])});var o=f(r,v,p,g,h);return o._picker=r,_(r,o),r.on("let.tag",d)},detach:function(){var t,r=this,e=l(r);return e&&e.destroy(),t=r,s.delete(t),r.off("let.tag",d)},name:"TagPicker.Sort"}}));