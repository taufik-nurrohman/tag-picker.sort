/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=t.TagPicker||{},t.TagPicker.Sort=e())}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||function(t,e){return t&&n(e)&&t instanceof e}(t,Object))},n=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return i(e)}))},i=function(t){return t.toUpperCase()},u=function(e){if(t(e))return e.map((function(t){return u(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(e);if(r(e)){for(var n in e)e[n]=u(e[n]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},a=function(e){if(t(e))return e.map((function(t){return a(e)}));if(r(e)){for(var n in e)e[n]=a(e[n]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},c=function(t,e,r){var n=function(t,e,r){if(void 0===r&&(r=!0),!s(t,e))return null;var n=t.getAttribute(e);return r?u(n):n}(t,"data-"+e,r);return n},s=function(t,e){return t.hasAttribute(e)},f=function(t,e){return t.style[o(e)]=null,t},l=function(t,e,r){return t.style[o(e)]=a(r),t},v=new WeakMap;function d(t,e,r,n,o){var i=t._mask,u=t.state.n,a=i.tags,c=u+="__tag--";return new Sortable(a,{animation:150,chosenClass:c+"select",dataIdAttr:"data-value",dragClass:c+"move",filter:"."+u+"__text",forceFallback:!0,ghostClass:c+"ghost",onEnd:e,onMove:r,onSort:n,onStart:o,selectedClass:c+"selected"})}function p(t){return v.get(t)}function _(t){var e=p(this)._picker,r=t.from,n=t.to;e._event=t,r&&f(r,"cursor"),n&&f(n,"cursor")}function g(){var t=this,e=p(t);e&&e.destroy(),(e=d(t,_,h,m,y))._picker=t,k(t,e)}function h(t){var e=this._picker,r=e._active,n=e._mask.text;if(r)return e._event=t,t.related!==n}function m(t){var e,r=this._picker,n=r._active,o=r._mask,i=r.self,u=r.state,a=o.tags,s=t.item;if(n){r._event=t;var l=this.toArray().slice(0,-1);i.value=l.join(u.join),r.fire("sort.tag",[t,e=c(s,"value",!1)]).fire("change",[t,e]),r.value=r.value,f(a,"cursor")}}function y(t){var e=this._picker,r=e._active,n=t.from,o=t.to;r&&(e._event=t,n&&l(n,"cursor","move"),o&&l(o,"cursor","move"))}function k(t,e){return v.set(t,e)}return{attach:function(){var t=this,r=t.constructor._;!e(r.reverse)&&(r.reverse=function(){var t=this,e=p(t),r=t._active,n=t._event,o=t.self,i=t.state.join;if(!r)return t;var u=e.toArray(),a=u.pop();return u=u.reverse(),o.value=u.join(i),e.sort(u.concat(a),!0),t.fire("sort.tags",[n,u])}),!e(r.sort)&&(r.sort=function(t){var e=this,r=p(e),n=e._active,o=e._event,i=e.self,u=e.state.join;if(!n)return e;t=(t||function(t,e){return t.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}).bind(e);var a=r.toArray(),c=a.pop();return a=a.sort(t),i.value=a.join(u),r.sort(a.concat(c),!0),e.fire("sort.tags",[o,a])});var n=d(t,_,h,m,y);return n._picker=t,k(t,n),t.on("let.tag",g)},detach:function(){var t,e=this,r=p(e);return r&&r.destroy(),t=e,v.delete(t),e.off("let.tag",g)},name:"TagPicker.Sort"}}));