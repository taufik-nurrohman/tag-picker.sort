/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=t.TagPicker||{},t.TagPicker.Sort=e())}(this,(function(){"use strict";var t=function(t){return"function"==typeof t},e=function(t){return t.length},n=document,r=window,o=function(t,e){var n=t.children;return"number"==typeof e?n[e]||null:n||[]},i=function(t,e){return t.classList.add(e),t},a=new WeakMap,s=Sortable.utils;function c(t){var n=this.option("selectedClass"),o=t.item,a=t.items;r.setTimeout((function(){e(a)&&a.forEach((function(t){return i(t,n)})),i(o,n).focus()}))}function l(t){var e,n=this,i=n._excludes,a=n._excludesPositions,c=!1;return r.clearTimeout(n._move),n._move=r.setTimeout((function(){var e=t.to;i.forEach((function(t,n){var r=a[n];if(t!==o(e,r)){var i=s.index(t);e.insertBefore(t,o(e,r+(i<r)))}}))})),i.forEach((function(n,r){var o;n===t.related&&(c=!0),n===(t.related["next"+(o?"":"Element")+"Sibling"]||null)&&t.relatedRect.top<t.draggedRect.top&&(e=-1)})),!c&&e}function u(t){var n=this._picker,r=t.item,o=t.items,i=this.toArray();i.pop(),console.log(i),n.fire("sort.tag"+(o?"s":""),[e(o)?o.map((function(t){return t.title})):r.title]).fire("change",e(o)?[]:[r.title])}function f(t){var e,r=this,o=[].slice.call((e=r.option("filter"),(r.el||n).querySelectorAll(e))),i=o.map((function(t){return s.index(t)}));r._picker,r._excludes=o,r._excludesPositions=i,r._move=null}return{attach:function(){var e=this,n=e.constructor.prototype;!t(n.reverse)&&(n.reverse=function(){var t=this;t._active;return t}),!t(n.sort)&&(n.sort=function(t){var e=this;e._active;return e});var r,o,i=e._mask,s=e.self,d=e.state,h=i.tags,v=d.n,m=v+"__tag--",p=new Sortable(h,{animation:150,avoidImplicitDeselect:!1,chosenClass:m+"touch",dataIdAttr:"title",dragClass:m+"move",filter:"."+v+"__text",forceFallback:!0,ghostClass:m+"ghost",multiDrag:!0,multiDragKey:"ctrl",onEnd:c,onMove:l,onSort:u,onStart:f,preventOnFilter:!1,selectedClass:m+"selected",touchStartThreshold:1});return p._picker=e,r=s,o=p,a.set(r,o),e},detach:function(){var t,e=(t=this.self,a.get(t));e&&e.destroy()},name:"TagPicker.Sort"}}));