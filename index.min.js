/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):((t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=t.TagPicker||{},t.TagPicker.Sort=r())}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},r=function(t){return"function"==typeof t},e=function(t,r){return void 0===r&&(r=!0),"object"==typeof t&&(!r||function(t,r){return t&&n(r)&&t instanceof r}(t,Object))},n=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return t.replace(/[-_.](\w)/g,(function(t,r){return i(r)}))},i=function(t){return t.toUpperCase()},u=function(r){if(t(r))return r.map((function(t){return u(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(r))return function(t,r){return void 0===r&&(r=10),r?parseInt(t,r):parseFloat(t)}(r);if(e(r)){for(var n in r)r[n]=u(r[n]);return r}return"false"!==r&&("null"===r?null:"true"===r||r)},a=function(r){if(t(r))return r.map((function(t){return a(r)}));if(e(r)){for(var n in r)r[n]=a(r[n]);return r}return!1===r?"false":null===r?"null":!0===r?"true":""+r},c=function(t,r,e){void 0===e&&(e=!0);var n=function(t,r,e){if(void 0===e&&(e=!0),!s(t,r))return null;var n=t.getAttribute(r);return e?u(n):n}(t,"data-"+r,e),o=(n+"").trim();return e&&o&&("["===o[0]&&"]"===o.slice(-1)||"{"===o[0]&&"}"===o.slice(-1))&&null!==(o=function(t){var r=null;try{r=JSON.parse(t)}catch(t){}return r}(n))?o:n},s=function(t,r){return t.hasAttribute(r)},f=function(t,r){return t.style[o(r)]=null,t},l=function(t,r,e){return t.style[o(r)]=a(e),t},v=new WeakMap;function d(t,r,e,n,o){var i=t._mask,u=t.state.n,a=i.tags,c=u+="__tag--";return new Sortable(a,{animation:150,chosenClass:c+"select",dataIdAttr:"data-name",dragClass:c+"move",filter:"."+u+"__text",forceFallback:!0,ghostClass:c+"ghost",onEnd:r,onMove:e,onSort:n,onStart:o,selectedClass:c+"selected"})}function p(t){return v.get(t)}function _(t){var r=p(this)._picker,e=t.from,n=t.to;r._event=t,e&&f(e,"cursor"),n&&f(n,"cursor")}function g(){var t=this,r=p(t);r&&r.destroy(),(r=d(t,_,h,m,y))._picker=t,k(t,r)}function h(t){var r=this._picker,e=r._active,n=r._mask.text;if(e)return r._event=t,t.related!==n}function m(t){var r,e=this._picker,n=e._active,o=e._mask,i=e.self,u=e.state,a=o.tags,s=t.item;if(n){e._event=t;var l=this.toArray().slice(0,-1);i.value=l.join(u.join),e.fire("sort.tag",[t,r=c(s,"name")]).fire("change",[t,r]),e.value=e.value,f(a,"cursor")}}function y(t){var r=this._picker,e=r._active,n=t.from,o=t.to;e&&(r._event=t,n&&l(n,"cursor","move"),o&&l(o,"cursor","move"))}function k(t,r){return v.set(t,r)}return{attach:function(){var t=this,e=t.constructor.prototype;!r(e.reverse)&&(e.reverse=function(){var t=this,r=p(t),e=t._active,n=t._event,o=t.self,i=t.state.join;if(!e)return t;var u=r.toArray(),a=u.pop();return u=u.reverse(),o.value=u.join(i),r.sort(u.concat(a),!0),t.fire("sort.tags",[n,u])}),!r(e.sort)&&(e.sort=function(t){var r=this,e=p(r),n=r._active,o=r._event,i=r.self,u=r.state.join;if(!n)return r;t=(t||function(t,r){return t.localeCompare(r,void 0,{numeric:!0,sensitivity:"base"})}).bind(r);var a=e.toArray(),c=a.pop();return a=a.sort(t),i.value=a.join(u),e.sort(a.concat(c),!0),r.fire("sort.tags",[o,a])});var n=d(t,_,h,m,y);return n._picker=t,k(t,n),t.on("let.tag",g)},detach:function(){var t,r=this,e=p(r);return e&&e.destroy(),t=r,v.delete(t),r.off("let.tag",g)},name:"TagPicker.Sort"}}));