/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=t.TagPicker||{},t.TagPicker.Sort=e())}(this,(function(){"use strict";var t=function(t){return"function"==typeof t},e=function(t){return"number"==typeof t},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||function(t,e){return t&&n(e)&&t instanceof e}(t,Object))},n=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return i(e)}))},i=function(t){return t.toUpperCase()},u=function(t){if(function(t){return Array.isArray(t)}(t))return t.map((function(e){return u(t)}));if(r(t)){for(var e in t)t[e]=u(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},a=document,s=window,c=function(t,r){var n=t.children;return e(r)?n[r]||null:n||[]},l=function(t,e){return t.style[o(e)]=null,t},f=function(t,r,n){return e(n)&&(n+="px"),t.style[o(r)]=u(n),t},v=new WeakMap,d=Sortable.utils;function p(t,e){t.forEach(e)}function m(t){return v.get(t)}function h(t){var e=this.option("selectedClass"),r=t.from,n=t.item,o=t.to;s.setTimeout((function(){return(t=n,r=e,t.classList.add(r),t).focus();var t,r})),r&&l(r,"cursor"),o&&l(o,"cursor")}function g(t){var e,r=this,n=r._excludes,o=r._excludesPositions,i=!1;return s.clearTimeout(r._move),r._move=s.setTimeout((function(){var e=t.from||t.to;p(n,(function(t,r){var n=o[r];if(t!==c(e,n)){var i=d.index(t);e.insertBefore(t,c(e,n+(i<n)))}}))})),p(n,(function(r,n){var o;r===t.related&&(i=!0),r===(t.related["next"+(o?"":"Element")+"Sibling"]||null)&&t.relatedRect.top<t.draggedRect.top&&(e=-1)})),!i&&e}function _(t){var e,r=this._picker;r._tags;var n=r.self,o=r.state,i=t.item,u=this.toArray().slice(0,-1);n.value=u.join(o.join),r.fire("sort.tag",[e=i.title]).fire("change",[e]),r.value=r.value}function y(t){var e,r=this,n=[].slice.call((e=r.option("filter"),(r.el||a).querySelectorAll(e))),o=n.map((function(t){return d.index(t)})),i=t.from;t.item,t.items;var u=t.to;r._picker,r._excludes=n,r._excludesPositions=o,r._move=null,i&&f(i,"cursor","move"),u&&f(u,"cursor","move")}return{attach:function(){var e=this,r=e.constructor.prototype;!t(r.reverse)&&(r.reverse=function(){var t=this,e=m(t),r=t._active,n=t.self,o=t.state.join;if(!r)return t;var i=e.toArray(),u=i.pop();return i=i.reverse(),n.value=i.join(o),e.sort(i.concat(u),!0),t.fire("sort.tags",[i])}),!t(r.sort)&&(r.sort=function(t){var e=this,r=m(e),n=e._active,o=e.self,i=e.state.join;if(!n)return e;t=(t||function(t,e){return t.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}).bind(e);var u=r.toArray(),a=u.pop();return u=u.sort(t),o.value=u.join(i),r.sort(u.concat(a),!0),e.fire("sort.tags",[u])});var n=e._mask;e.self;var o,i,u=e.state,a=n.tags,s=u.n,c=s+"__tag--",l=new Sortable(a,{animation:150,chosenClass:c+"select",dataIdAttr:"title",dragClass:c+"move",filter:"."+s+"__text",forceFallback:!0,ghostClass:c+"ghost",onEnd:h,onMove:g,onSort:_,onStart:y,selectedClass:c+"selected",touchStartThreshold:1});return l._picker=e,o=e,i=l,v.set(o,i),e},detach:function(){var t,e=m(this);t=this,v.delete(t),e&&e.destroy()},name:"TagPicker.Sort"}}));